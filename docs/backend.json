{
  "entities": {
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents a scheduled appointment at the beauty salon.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the appointment."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Appointment)"
        },
        "stylistId": {
          "type": "string",
          "description": "Reference to Stylist. (Relationship: Stylist 1:N Appointment)"
        },
        "serviceId": {
          "type": "string",
          "description": "Reference to Service. (Relationship: Service 1:N Appointment)"
        },
        "startTime": {
          "type": "string",
          "description": "The date and time the appointment is scheduled to begin.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The date and time the appointment is scheduled to end.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the appointment (e.g., scheduled, confirmed, cancelled).",
          "format": "string"
        },
        "notes": {
          "type": "string",
          "description": "Any notes or special requests for the appointment."
        }
      },
      "required": [
        "id",
        "customerId",
        "stylistId",
        "serviceId",
        "startTime",
        "endTime",
        "status"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer of the beauty salon.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "firstName": {
          "type": "string",
          "description": "The customer's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The customer's last name."
        },
        "email": {
          "type": "string",
          "description": "The customer's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The customer's phone number."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone"
      ]
    },
    "Stylist": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Stylist",
      "type": "object",
      "description": "Represents a stylist at the beauty salon.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stylist."
        },
        "firstName": {
          "type": "string",
          "description": "The stylist's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The stylist's last name."
        },
        "email": {
          "type": "string",
          "description": "The stylist's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The stylist's phone number."
        },
        "availability": {
          "type": "string",
          "description": "The stylist's availability (e.g., days and hours they are available).  Consider a more structured approach like a separate Availability entity."
        },
        "specializations": {
          "type": "array",
          "description": "A list of service IDs that this stylist is qualified to perform.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone",
        "availability"
      ]
    },
    "Service": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Service",
      "type": "object",
      "description": "Represents a service offered by the beauty salon.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the service."
        },
        "name": {
          "type": "string",
          "description": "The name of the service."
        },
        "description": {
          "type": "string",
          "description": "A description of the service."
        },
        "price": {
          "type": "number",
          "description": "The price of the service.",
          "format": "number"
        },
        "duration": {
          "type": "number",
          "description": "The duration of the service in minutes.",
          "format": "number"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "duration"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profiles.  Appointments are stored as a subcollection. Used for path-based ownership.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores appointment information for each customer. Includes denormalized `stylistId` to avoid cross-collection reads for security rules.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            },
            {
              "name": "appointmentId",
              "description": "The unique identifier for the appointment."
            }
          ]
        }
      },
      {
        "path": "/stylists/{stylistId}",
        "definition": {
          "entityName": "Stylist",
          "schema": {
            "$ref": "#/backend/entities/Stylist"
          },
          "description": "Stores stylist profiles. Appointments are stored as a subcollection.",
          "params": [
            {
              "name": "stylistId",
              "description": "The unique identifier for the stylist."
            }
          ]
        }
      },
      {
        "path": "/stylists/{stylistId}/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores appointment information for each stylist. Includes denormalized `customerId` and `serviceId` to avoid cross-collection reads for security rules.",
          "params": [
            {
              "name": "stylistId",
              "description": "The unique identifier for the stylist."
            },
            {
              "name": "appointmentId",
              "description": "The unique identifier for the appointment."
            }
          ]
        }
      },
      {
        "path": "/services/{serviceId}",
        "definition": {
          "entityName": "Service",
          "schema": {
            "$ref": "#/backend/entities/Service"
          },
          "description": "Stores service information.",
          "params": [
            {
              "name": "serviceId",
              "description": "The unique identifier for the service."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Collection to store admin roles. Existence of document implies admin privileges.  No content required.",
          "params": [
            {
              "name": "uid",
              "description": "The unique identifier for the user (admin)."
            }
          ]
        }
      },
      {
        "path": "/admin/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores all appointment information for the admin dashboard. Allows filtering, editing and deleting appointments.",
          "params": [
            {
              "name": "appointmentId",
              "description": "The unique identifier for the appointment."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the beauty salon application's requirements, focusing on appointment scheduling, service management, stylist management, and an admin dashboard. The structure prioritizes Authorization Independence through denormalization and supports secure list operations. Since there are no roles explicitly defined, the data structure assumes the need for admin roles. The structure also uses path-based ownership for customers, stylists, and their respective appointments, while ensuring clear segregation between user-owned and admin-managed data.\n\n**Authorization Independence:** The `appointments` subcollection within each stylist's document includes denormalized fields like `customerId`, `serviceId`, and potentially a copy of the customer's name or other relevant information. This eliminates the need for `get()` calls to other collections when enforcing security rules related to appointments. The admin dashboard will be in a separate collection without user context.\n\n**QAPs Support:** The segregation of data into customer-owned and stylist-owned appointments supports secure `list` operations. Rules can easily filter appointments based on the requesting user's ID or based on admin roles within the `/roles_admin/{uid}` collection. The separation between stylists' appointments and the admin's view ensures that stylists only see their own schedules, while admins have a global view."
  }
}